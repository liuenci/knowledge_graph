# Java 内存模型各区域总结
按照 Java 虚拟机的规范，Java 的内存区域主要分为以下五个。
● 程序计数器
● Java 虚拟机栈
● 本地方法栈
● 堆
● 方法区

## 程序计数器
程序计数器是属于线程私有的一块较小的内存空间，记录当前线程所执行的字节码行号，当执行一段 Java 代码时，计数器会记录虚拟机字节码当前指令的地址，但是如果是本地地址则是空的，这一块不会发生 OutOfMemoryError。

## Java 虚拟机栈
Java 虚拟机栈的作用主要是存储和使用的一个介质，可以理解成一个容器，在我们执行 Java 的方法的时候，会创建一个栈帧，相当于一个内存区域或者片段存放在 Java 虚拟机栈中，那么每一个栈帧，会存放局部变量表、操作数栈、动态链接、方法出口以及线程等信息，一个方法的调用到一个方法的执行完成，对应者栈帧在 Java 虚拟机栈中入栈和出栈的过程，最终栈帧会随着方法的创建到结束而销毁。

## 本地方法栈
本地方法栈和 Java 虚拟机栈基本上类似，区别是两者执行的方法是不一样的，本地方法栈主要执行的是 Native 方法，而 Java 虚拟机栈执行的是普通的 Java 方法。

在本地方法栈这个区域里面，也会出现 StackOverflowError 以及 OutOfMemoryError 两种异常。
在 Java1.8 中 HotSpot 虚拟机将两个栈给合二为一了。

## 堆
Java 的堆内存是 Java 内存区域里面最大的一块，但是并不是连续的一块区域，并且堆大小可以动态调增。
堆下面又细分两块区域，分别是年轻代和老年代，分别占据 1/3 和 2/3 的位置。
年轻代又细分为三块区域，分别是 Eden、From survivor 以及 To survivor ，比例分别为 8:1:1，这个比例是可以调整的。

案例：假设一台服务器的物理内存为 4G，那么年轻代可以占据 4*1024/3=1365M的大小空间。

如何调整年轻代区域的比例划分？

## 方法区
方法区本质上也是属于堆上的一块区域，但是为了和堆做区分，它也被称之为非堆，非堆并不是指除了堆以外的区域，而是指的方法区，方法区的作用也是被所有线程共享，主要用于储存类的信息、常量池、方法数据以及方法代码等。

方法区是 Java 规范中的一种定义，具体的实现有两种，分别是 Java1.7 的永久代，以及 Java1.8 的元空间。

永久代是和堆相邻近，逻辑上是一块区域，而元空间和堆是分开的，和堆不再连续，元空间存在于本地内存中。

## 为什么 Java8 放弃永久代，而启用元空间的实现方式？
因为永久代和堆的物理内存是连续的，容易出现 OOM，而元空间使用的不是堆的内存，理论上是可以无限使用的，不过可以通过配置参数来限制元空间的使用大小。
● -XX:MetaspaceSize 元空间初始配额
● -XX:MaxMetaspaceSize 元空间最大空间
